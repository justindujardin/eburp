
/*!
  pow2 - v0.0.21
  built: 2014-11-28
 */

var pow2;!function(a){function b(b,c){a.data[b]=c}function c(b){return a.data[b]}function d(b,c){a.data.maps[b]=c}function e(b){for(var c in b)b.hasOwnProperty(c)&&(a.data.sprites[c]=_.extend(a.data.sprites[c]||{},b[c]))}function f(b,c){for(var d in c)c.hasOwnProperty(d)&&(a.data.sprites[d]=_.defaults(a.data.sprites[d]||{},c[d]))}function g(b){return a.data.sprites[b]}function h(b,c){_.each(c,function(c){a.data.creatures.push(_.extend(c,{level:b}))})}function i(b){return a.data.maps[b]}function j(){return a.data.maps}a.SPREADSHEET_ID="1IAQbt_-Zq1BUwRNiJorvt4iPEYb5HmZrpyMOkb-OuJo",a.data={maps:{},sprites:{},items:{},creatures:[],weapons:[],armor:[]},a.registerData=b,a.getData=c,a.registerMap=d,a.describeSprites=e,a.registerSprites=f,a.getSpriteMeta=g,a.registerCreatures=h,a.getMap=i,a.getMaps=j}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function b(){this.interpFrame=0,this.animElapsed=0,this.animDuration=0,this.frames=[0],this.sourceMeta=null,this.sourceAnims=null}return b.prototype.setAnimationSource=function(b){console.log("Sprite is "+b),this.sourceMeta=a.getSpriteMeta(b),this.sourceAnims=this.sourceMeta.animations,this.setAnimation("down")},b.prototype.setAnimation=function(a){if(!this.sourceAnims)throw new Error("Invalid source animations");var b=this.sourceAnims[a];if(!b)throw new Error("Invalid animation name - "+a);this.frames=b.frames,this.animDuration=b.duration},b.prototype.updateTime=function(a){this.animElapsed+=a;var b=this.animElapsed/this.animDuration,c=Math.round(this.interpolate(0,this.frames.length-1,b));this.interpFrame=this.frames[c],this.animElapsed>this.animDuration&&(this.animElapsed=0)},b.prototype.interpolate=function(a,b,c){return c=Math.min(Math.max(c,0),1),a*(1-c)+b*c},b.prototype.getFrame=function(){return this.interpFrame},b}();a.Animator=b}(pow2||(pow2={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},pow2;!function(a){var b=function(b){function c(c){b.call(this),this._uid=_.uniqueId("so"),this._components=[],_.extend(this,_.defaults(c||{}),{point:new a.Point(0,0),size:new a.Point(1,1),enabled:!0})}return __extends(c,b),c.prototype.tick=function(a){if(this.enabled)for(var b=this._components,c=this._components.length,d=0;c>d;d++)b[d].tick&&b[d].tick(a)},c.prototype.interpolateTick=function(a){if(this.enabled)for(var b=this._components,c=this._components.length,d=0;c>d;d++)b[d].interpolateTick&&b[d].interpolateTick(a)},c.prototype.destroy=function(){_.each(this._components,function(a){a.disconnectComponent()}),this.scene&&this.scene.removeObject(this,!1)},c.prototype.findComponent=function(a){for(var b=this._components,c=this._components.length,d=0;c>d;d++){var e=b[d];if(e instanceof a)return e}return null},c.prototype.findComponents=function(a){for(var b=this._components,c=[],d=this._components.length,e=0;d>e;e++){var f=b[e];f instanceof a&&c.push(f)}return c},c.prototype.syncComponents=function(){for(var a=this._components,b=this._components.length,c=0;b>c;c++)a[c].syncComponent()},c.prototype.addComponent=function(a,b){if(void 0===b&&(b=!1),_.where(this._components,{id:a.id}).length>0)throw new Error("Component added twice");return a.host=this,a.connectComponent()===!1?(delete a.host,console.log("Component "+a.name+" failed to register."),!1):(this._components.push(a),b!==!0&&this.syncComponents(),!0)},c.prototype.addComponentDictionary=function(a){var b=this,c=null;return _.each(a,function(a){c||b.addComponent(a,!0)||(c=a)}),c?console.log("Failed to add component set to host. Component "+c.toString()+" failed to connect to host."):this.syncComponents(),!c},c.prototype.removeComponentDictionary=function(a,b){var c=this._components.length,d=_.map(a,function(a){return a.id});this._components=_.filter(this._components,function(a){return-1!==_.indexOf(d,a.id)?a.disconnectComponent()===!1?!0:(a.host=null,!1):!0});var e=this._components.length===c;return e&&b!==!0&&this.syncComponents(),e},c.prototype.removeComponentByType=function(a,b){void 0===b&&(b=!1);var c=this.findComponent(a);return c?this.removeComponent(c):!1},c.prototype.removeComponent=function(a,b){void 0===b&&(b=!1);var c=this._components.length;this._components=_.filter(this._components,function(b){return b.id===a.id?b.disconnectComponent()===!1?!0:(b.host=null,!1):!0});var d=this._components.length===c;return d&&b!==!0&&this.syncComponents(),d},c.prototype.toString=function(){var a=this.constructor,b=this.name;return a&&"Function"!=a.name&&(b=a.name||(this.toString().match(/function (.+?)\(/)||[,""])[1]),_.each(this._components,function(a){b+=", "+a}),b},c}(a.Events);a.SceneObject=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(b){function c(d,e){if(b.call(this),this.cameraComponent=null,this.scene=null,this.loader=null,this.animations=[],this.canvas=d,!d)throw new Error("A Canvas is required");if(this.$el=$(d),this.context=d.getContext("2d"),!this.context)throw new Error("Could not retrieve Canvas context");var f=this.context;f.webkitImageSmoothingEnabled=!1,f.mozImageSmoothingEnabled=!1,this.camera=new a.Rect(0,0,9,9),this.cameraScale=1,this.unitSize=c.UNIT,this._sheets={},this.loader=e}return __extends(c,b),c.prototype.onAddToWorld=function(){},c.prototype.onRemoveFromWorld=function(){},c.prototype.setScene=function(a){this.scene&&this.scene.removeView(this),this.scene=a,this.scene&&this.scene.addView(this)},c.prototype.renderToCanvas=function(a,b,c){var d=document.createElement("canvas");d.width=a,d.height=b;var e=d.getContext("2d");return e.webkitImageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,c(e),d},c.prototype.renderFrame=function(){},c.prototype.renderPost=function(){},c.prototype.setRenderState=function(){this.context&&(this.context.save(),this.context.scale(this.cameraScale,this.cameraScale))},c.prototype.restoreRenderState=function(){return this.context?(this.context.restore(),!0):!1},c.prototype.render=function(){this._render(0)},c.prototype._render=function(a){this.processCamera(),this.setRenderState(),this.renderFrame(a),this.renderAnimations(),this.renderPost(),this.restoreRenderState()},c.prototype.processCamera=function(){this.cameraComponent&&this.cameraComponent.process(this)},c.prototype.clearRect=function(){var a,b,c;return b=c=0,this.camera&&(a=this.worldToScreen(this.camera.point),b=a.x,c=a.y),this.context.clearRect(b,c,this.context.canvas.width,this.context.canvas.height)},c.prototype.worldToScreen=function(b,c){if(void 0===c&&(c=1),b instanceof a.Rect){var d=new a.Rect(b);return d.point.multiply(this.unitSize*c),d.extent.multiply(this.unitSize*c),d}return b instanceof a.Point?new a.Point(b).multiply(this.unitSize*c):b*this.unitSize*c},c.prototype.screenToWorld=function(b,c){if(void 0===c&&(c=1),b instanceof a.Rect){var d=new a.Rect(b);return d.point.multiply(1/(this.unitSize*c)),d.extent.multiply(1/(this.unitSize*c)),d}return b instanceof a.Point?new a.Point(b).multiply(1/(this.unitSize*c)):b*(1/(this.unitSize*c))},c.prototype.fastWorldToScreenPoint=function(a,b,c){return void 0===c&&(c=1),b.set(a),b.multiply(this.unitSize*c),b},c.prototype.fastWorldToScreenRect=function(a,b,c){return void 0===c&&(c=1),b.set(a),b.point.multiply(this.unitSize*c),b.extent.multiply(this.unitSize*c),b},c.prototype.fastWorldToScreenNumber=function(a,b){return void 0===b&&(b=1),a*this.unitSize*b},c.prototype.fastScreenToWorldPoint=function(a,b,c){return void 0===c&&(c=1),b.set(a),b.multiply(1/(this.unitSize*c)),b},c.prototype.fastScreenToWorldRect=function(a,b,c){return void 0===c&&(c=1),b.set(a),b.point.multiply(1/(this.unitSize*c)),b.extent.multiply(1/(this.unitSize*c)),b},c.prototype.fastScreenToWorldNumber=function(a,b){return void 0===b&&(b=1),a*(1/(this.unitSize*b))},c.prototype.renderAnimations=function(){var a,b,c;for(a=0,b=this.animations.length;b>a;a++)c=this.animations[a],c.done=c.fn(c.frame),this.scene.time>=c.time&&(c.frame+=1,c.time=this.scene.time+c.rate);return this.animations=_.filter(this.animations,function(a){return a.done!==!0})},c.UNIT=16,c}(a.SceneObject);a.SceneView=b}(pow2||(pow2={}));var pow2;!function(a){!function(a){a[a.UP=38]="UP",a[a.DOWN=40]="DOWN",a[a.LEFT=37]="LEFT",a[a.RIGHT=39]="RIGHT",a[a.BACKSPACE=8]="BACKSPACE",a[a.COMMA=188]="COMMA",a[a.DELETE=46]="DELETE",a[a.END=35]="END",a[a.ENTER=13]="ENTER",a[a.ESCAPE=27]="ESCAPE",a[a.HOME=36]="HOME",a[a.SPACE=32]="SPACE",a[a.TAB=9]="TAB"}(a.KeyCode||(a.KeyCode={}));var b=(a.KeyCode,function(){function b(){var a=this;this._keysDown={},this._mouseElements=[],window.addEventListener("keydown",function(b){a._keysDown[b.which]=!0}),window.addEventListener("keyup",function(b){a._keysDown[b.which]=!1});var c=this._mouseElements;window.addEventListener("mousemove touchmove",function(a){for(var d=c.length,e=0;d>e;e++){var f=c[e];a.srcElement===f.view.canvas?b.mouseOnView(a,f.view,f):(f.point.set(-1,-1),f.world.set(-1,-1))}})}return b.mouseOnView=function(b,c,d){var e=b.srcElement,f=b.touches;f&&f.length>0&&(b=f[0]);var g=d||{point:new a.Point,world:new a.Point},h=$(e).offset(),i=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-Math.floor(h.left),j=b.clientY+document.body.scrollTop+document.documentElement.scrollTop-Math.floor(h.top);g.point.set(i,j);var k=c.screenToWorld(g.point,c.cameraScale).add(c.camera.point).round();return g.world.set(k.x,k.y),g},b.prototype.mouseHook=function(b,c){var d=_.where(this._mouseElements,{name:c});if(d.length>0)return d[0];var e={name:c,view:b,point:new a.Point(-1,-1),world:new a.Point(-1,-1)};return this._mouseElements.push(e),e},b.prototype.mouseUnhook=function(a){this._mouseElements=_.filter(this._mouseElements,function(b){return b.name===a||b.view._uid===a._uid})},b.prototype.getMouseHook=function(a){return _.find(this._mouseElements,function(b){return b.name===a||b.view._uid===a._uid})},b.prototype.keyDown=function(a){return!!this._keysDown[a]},b}());a.Input=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function b(){this.canvas=null,this.context=null,this.world=null,this.canvas=document.createElement("canvas"),this.sizeCanvas(b.SIZE,b.SIZE)}return b.prototype.onAddToWorld=function(){},b.prototype.onRemoveFromWorld=function(){},b.prototype.sizeCanvas=function(a,b){this.canvas.width=a,this.canvas.height=b,this.context=this.canvas.getContext("2d"),this.context.webkitImageSmoothingEnabled=!1,this.context.mozImageSmoothingEnabled=!1},b.prototype.getSpriteSheet=function(a,b){return this.world?this.world.loader.load("/images/"+a+".png",b):null},b.prototype.getSingleSprite=function(b,c,d){var e=this;void 0===c&&(c=0),void 0===d&&(d=function(){});var f=a.data.sprites[b];if(!f)throw new Error("Unable to find sprite by name: "+b);return this.getSpriteSheet(f.source,function(a){var f=e.getSpriteRect(b,c);e.sizeCanvas(f.extent.x,f.extent.y),e.context.clearRect(0,0,e.canvas.width,e.canvas.height),e.context.drawImage(a.data,f.point.x,f.point.y,f.extent.x,f.extent.y,0,0,e.canvas.width,e.canvas.height);var g=e.canvas.toDataURL(),h=new Image;h.src=g,h.onload=function(){d&&d(h)},h.onerror=function(a){d&&d(a)}})},b.prototype.getSpriteRect=function(c,d){void 0===d&&(d=0);var e=this.getSpriteMeta(c),f=e.x,g=e.y;if(e.frames>1){var h=b.SIZE,i=b.SIZE;e&&"undefined"!=typeof e.cellWidth&&"undefined"!=typeof e.cellHeight&&(h=e.cellWidth,i=e.cellHeight);var j=e.width/h,k=d%j,l=Math.floor((d-k)/j);f+=k*h,g+=l*i}else h=e.width,i=e.height;return new a.Rect(f,g,h,i)},b.prototype.getSpriteMeta=function(b){var c=a.data.sprites[b];if(!c)throw new Error("Missing sprite data for: "+b);return c},b.SIZE=16,b}();a.SpriteRender=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.defaultState=null,this.states=[],this._currentState=null,this._previousState=null,this._newState=!1}return __extends(b,a),b.prototype.onAddToWorld=function(){},b.prototype.onRemoveFromWorld=function(){},b.prototype.update=function(){this._newState=!1,null===this._currentState&&this.setCurrentState(this.defaultState),null!==this._currentState&&this._currentState.update(this),this._newState===!1&&null!==this._currentState&&(this._previousState=this._currentState)},b.prototype.addState=function(a){this.states.push(a)},b.prototype.addStates=function(a){this.states=_.unique(this.states.concat(a))},b.prototype.getCurrentState=function(){return this._currentState},b.prototype.getCurrentName=function(){return null!==this._currentState?this._currentState.name:null},b.prototype.setCurrentState=function(a){var b="string"==typeof a?this.getState(a):a,c=this._currentState;return b?this._currentState&&b.name===this._currentState.name?(console.warn("Attempting to set current state to already active state"),!0):(this._newState=!0,this._previousState=this._currentState,this._currentState=b,c&&(this.trigger("exit",c,b),c.exit(this)),b.enter(this),this.trigger("enter",b,c),!0):(console.error("STATE NOT FOUND: "+a),!1)},b.prototype.getPreviousState=function(){return this._previousState},b.prototype.getState=function(a){var b=_.find(this.states,function(b){return b.name===a});return b},b}(a.Events);a.StateMachine=b;var c=function(a){function b(){a.apply(this,arguments),this.paused=!1}return __extends(b,a),b.prototype.onAddToWorld=function(a){a.time.addObject(this)},b.prototype.onRemoveFromWorld=function(a){a.time.removeObject(this)},b.prototype.tick=function(a){this.update(a)},b}(b);a.TickedStateMachine=c}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function a(){this.transitions=[]}return a.prototype.enter=function(){},a.prototype.exit=function(){},a.prototype.update=function(a){for(var b=this.transitions.length,c=0;b>c;c++){var d=this.transitions[c];if(d.evaluate(a)&&a.setCurrentState(d.targetState))return}},a}();a.State=b;var c=function(){function a(){}return a.prototype.evaluate=function(){return!0},a}();a.StateTransition=c}(pow2||(pow2={}));var pow2;!function(a){var b=function(b){function c(c){b.call(this,c),this.setService("input",new a.Input),this.setService("sprites",new a.SpriteRender)}return __extends(c,b),c}(a.World);a.SceneWorld=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function b(){this._pointRect=new a.Rect(0,0,1,1),this._objects=[]}return b.prototype.addSpatialObject=function(b){b&&b.point instanceof a.Point&&this._objects.push(b)},b.prototype.removeSpatialObject=function(a){this._objects=_.reject(this._objects,function(b){return b._uid===a._uid})},b.prototype.queryPoint=function(a,b,c){return this._pointRect.point.set(a),this.queryRect(this._pointRect,b,c)},b.prototype.queryRect=function(a,b,c){var d;if(!c)throw new Error("Results array must be provided to query scene spatial database");d=!1;var e,f,g,h=this._objects;for(e=0,f=h.length;f>e;e++)g=h[e],(!b||g instanceof b)&&g.enabled!==!1&&g.point&&a.pointInRect(g.point)&&(c.push(g),d=!0);return d},b}();a.SceneSpatialDatabase=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(b){function c(c){void 0===c&&(c={}),b.call(this),this.id=_.uniqueId("scene"),this.db=new a.SceneSpatialDatabase,this.options={},this._objects=[],this._views=[],this.world=null,this.fps=0,this.time=0,this.paused=!1,this.options=_.defaults(c||{},{debugRender:!1})}return __extends(c,b),c.prototype.destroy=function(){this.world&&this.world.erase(this);for(var a=this._objects.length,b=0;a>b;b++)this.removeObject(this._objects[b],!0);a=this._views.length;for(var b=0;a>b;b++)this.removeView(this._views[b]);this.paused=!0},c.prototype.onAddToWorld=function(a){a.time.addObject(this)},c.prototype.onRemoveFromWorld=function(a){a.time.removeObject(this)},c.prototype.tick=function(a){if(!this.paused)for(var b=this._objects.length,c=0;b>c;c++)this._objects[c]&&this._objects[c].tick(a)},c.prototype.processFrame=function(a){if(!this.paused){this.time=this.world.time.time;for(var b=this._objects.length,c=0;b>c;c++){var d=this._objects[c];d.interpolateTick&&d.interpolateTick(a)}b=this._views.length;for(var c=0;b>c;c++)this._views[c].render(a);var e=a?1e3/a:0;this.fps+=(e-this.fps)/10}},c.prototype.removeIt=function(a,b){var c=this,d=!1;return this[a]=_.filter(this[a],function(a){return b&&a&&a._uid===b._uid?(c.db.removeSpatialObject(a),a.onRemoveFromScene&&a.onRemoveFromScene(c),c.world&&c.world.erase(a),delete a.scene,d=!0,!1):a?!0:!1}),d},c.prototype.addIt=function(a,b){if(b.scene&&b.scene.removeIt(a,b),_.where(this[a],{_uid:b._uid}).length>0)throw new Error("Object added to scene twice");return this[a].push(b),this.world&&this.world.mark(b),this.db.addSpatialObject(b),b.scene=this,b.onAddToScene&&b.onAddToScene(this),!0},c.prototype.findIt=function(a,b){return _.where(this[a],{_uid:b._uid})},c.prototype.addView=function(a){return this.addIt("_views",a)},c.prototype.removeView=function(a){return this.removeIt("_views",a)},c.prototype.findView=function(a){return!!this.findIt("_views",a)},c.prototype.addObject=function(a){return this.addIt("_objects",a)},c.prototype.removeObject=function(a,b){b="undefined"==typeof b?!0:!!b;var c=a,d=this.removeIt("_objects",a);return c&&b&&c.destroy&&c.destroy(),d},c.prototype.findObject=function(a){return!!this.findIt("_objects",a)},c.prototype.componentByType=function(a){for(var b=this._objects,c=this._objects.length,d=0;c>d;d++){var e=b[d],f=e.findComponent(a);if(f)return f}return null},c.prototype.componentsByType=function(a){for(var b=this._objects,c=this._objects.length,d=[],e=0;c>e;e++){var f=b[e],g=f.findComponents(a);g&&(d=d.concat(g))}return d},c.prototype.objectsByName=function(a){for(var b=this._objects,c=this._objects.length,d=[],e=0;c>e;e++){var f=b[e];f.name===a&&d.push(f)}return d},c.prototype.objectByName=function(a){for(var b=this._objects,c=this._objects.length,d=0;c>d;d++){var e=b[d];if(e.name===a)return e}return null},c.prototype.objectsByType=function(a){for(var b=this._objects,c=this._objects.length,d=[],e=0;c>e;e++){var f=b[e];f instanceof a&&d.push(f)}return d},c.prototype.objectByType=function(a){for(var b=this._objects,c=this._objects.length,d=0;c>d;d++){var e=b[d];if(e instanceof a)return e}return null},c.prototype.objectsByComponent=function(a){for(var b=this._objects,c=this._objects.length,d=[],e=0;c>e;e++){var f=b[e];f.findComponent(a)&&d.push(f)}return d},c.prototype.objectByComponent=function(a){for(var b=this._objects,c=this._objects.length,d=0;c>d;d++){var e=b[d];if(e.findComponent(a))return e}return null},c}(a.Events);a.Scene=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(b){void 0===b&&(b=_.uniqueId("comp")),a.call(this),this.name=b,this.id=_.uniqueId("sc")}return __extends(b,a),b.prototype.connectComponent=function(){return this.scene=this.host.scene,!0},b.prototype.disconnectComponent=function(){return this.scene=null,!0},b.prototype.syncComponent=function(){return this.scene=this.host.scene,!!this.scene},b.prototype.toString=function(){var a=this.constructor;return a&&"Function"!=a.name?a.name||(this.toString().match(/function (.+?)\(/)||[,""])[1]:this.name},b}(a.Events);a.SceneComponent=b;var c=function(a){function b(){a.apply(this,arguments),this.tickRateMS=300}return __extends(b,a),b.prototype.tick=function(){},b.prototype.interpolateTick=function(){},b}(b);a.TickedComponent=c}(pow2||(pow2={}));var pow2;!function(a){var b=function(){function a(){}return a.prototype.render=function(){},a}();a.SceneObjectRenderer=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.process=function(b){b.camera.point.set(this.host.point),b.cameraScale=b.context.canvas.width>768?4:2;var c=b.screenToWorld(new a.Point(b.context.canvas.width,b.context.canvas.height),b.cameraScale);b.camera.extent.set(c)},c}(a.SceneComponent);a.CameraComponent=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(b){function c(){b.apply(this,arguments),this.collideBox=new a.Rect(0,0,1,1),this.resultsArray=[]}return __extends(c,b),c.prototype.collide=function(b,c,d,e){return void 0===d&&(d=a.SceneObject),void 0===e&&(e=[]),this.collideBox.point.x=b,this.collideBox.point.y=c,this.scene.db.queryRect(this.collideBox,d,e)},c.prototype.collideFirst=function(b,c,d){void 0===d&&(d=a.SceneObject),this.collideBox.point.x=b,this.collideBox.point.y=c,this.resultsArray.length=0;var e=this.scene.db.queryRect(this.collideBox,d,this.resultsArray);return e?this.resultsArray[0]:null},c}(a.SceneComponent);a.CollisionComponent=b}(pow2||(pow2={}));var pow2;!function(a){var b=function(b){function c(){b.apply(this,arguments),this._elapsed=0,this.path=[],this.tickRateMS=250,this.velocity=new a.Point(0,0),this.workPoint=new a.Point(0,0)}return __extends(c,b),c.prototype.connectComponent=function(){return this.host.point.round(),this.targetPoint=this.host.point.clone(),this.host.renderPoint=this.targetPoint.clone(),b.prototype.connectComponent.call(this)},c.prototype.syncComponent=function(){return this.collider=this.host.findComponent(a.CollisionComponent),b.prototype.syncComponent.call(this)},c.prototype.beginMove=function(){},c.prototype.endMove=function(){},c.prototype.collideMove=function(b,c,d){return void 0===d&&(d=[]),this.collider?this.collider.collide(b,c,a.SceneObject,d):!1},c.prototype.setMoveFilter=function(a){this.moveFilter=a},c.prototype.clearMoveFilter=function(){this.moveFilter=null},c.prototype.updateVelocity=function(){if(this.scene.world&&this.scene.world.input){var b=document.createTouch,c=this.scene.world.input;b&&c.analogVector instanceof a.Point?(this.velocity.x=0,c.analogVector.x<-20?this.velocity.x-=1:c.analogVector.x>20&&(this.velocity.x+=1),this.velocity.y=0,c.analogVector.y<-20?this.velocity.y-=1:c.analogVector.y>20&&(this.velocity.y+=1)):(this.velocity.x=0,c.keyDown(37)&&(this.velocity.x-=1),c.keyDown(39)&&(this.velocity.x+=1),this.velocity.y=0,c.keyDown(38)&&(this.velocity.y-=1),c.keyDown(40)&&(this.velocity.y+=1))}},c.prototype.interpolateTick=function(){var a;a=this._elapsed/this.tickRateMS,this.host.renderPoint.set(this.host.point.x,this.host.point.y),this.velocity.isZero()||(this.host.renderPoint.interpolate(this.host.point,this.targetPoint,a),this.host.renderPoint.x=parseFloat(this.host.renderPoint.x.toFixed(2)),this.host.renderPoint.y=parseFloat(this.host.renderPoint.y.toFixed(2)))},c.prototype.tick=function(a){if(this._elapsed+=a,!(this._elapsed<this.tickRateMS)){this._elapsed=this._elapsed%this.tickRateMS,this.targetPoint.equal(this.host.point)||this.collideMove(this.targetPoint.x,this.targetPoint.y)||(this.workPoint.set(this.host.point),this.host.point.set(this.targetPoint),this.endMove(this.workPoint,this.targetPoint)),this.updateVelocity(),this.targetPoint.set(this.host.point);var b=this.velocity.isZero();if(!b||0!==this.path.length){if(b){var c=this.path.shift();this.velocity.set(c.x-this.host.point.x,c.y-this.host.point.y)}else this.path.length=0;if(this.targetPoint.add(this.velocity),0===this.velocity.y||this.collideMove(this.host.point.x,this.targetPoint.y)){if(0===this.velocity.x||this.collideMove(this.targetPoint.x,this.host.point.y))return this.targetPoint.set(this.host.point),void(this.path.length=0);this.targetPoint.y=this.host.point.y}else this.targetPoint.x=this.host.point.x;var d=this.moveFilter||this.beginMove;d.call(this,this.host.point,this.targetPoint)}}},c}(a.TickedComponent);a.MovableComponent=b}(pow2||(pow2={}));var pow2;!function(a){var b={url:null,volume:1,loop:!1},c=function(a){function c(c){void 0===c&&(c=b),a.call(this),"undefined"!=typeof c&&_.extend(this,b,c)}return __extends(c,a),c.prototype.disconnectComponent=function(){return this.audio.isReady()&&(this.audio.data.pause(),this.audio.data.currentTime=0),a.prototype.disconnectComponent.call(this)},c.prototype.connectComponent=function(){var b=this;return a.prototype.connectComponent.call(this)&&this.url?this.audio&&this.audio.isReady()?(this.audio.data.currentTime=0,this.audio.data.volume=this.volume,!0):(this.audio=this.scene.world.loader.load(this.url,function(){b.audio.isReady()&&(b.audio.data.currentTime=0,b.audio.data.volume=b.volume,b.audio.data.loop=b.loop,b.audio.data.play(),b.audio.data.addEventListener("timeupdate",function(){b.audio.data.currentTime>=b.audio.data.duration&&(b.loop?b.trigger("audio:loop",b):(b.audio.data.pause(),b.trigger("audio:done",b)))}))}),!0):!1},c}(a.SceneComponent);a.SoundComponent=c}(pow2||(pow2={}));var pow2;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.machine=null,this.paused=!1}return __extends(b,a),b.prototype.tick=function(){this.paused||this.machine&&this.machine.update(this)},b}(a.TickedComponent);a.StateMachineComponent=b}(pow2||(pow2={}));
//# sourceMappingURL=pow2.min.map